<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Login & Register</title>
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../../global.css">
    <link rel="stylesheet" href="../../home.css">
    <link rel="stylesheet" href="../../css/auth/auth.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="../../js/auth/auth.js" defer></script>
</head>
<body>
 <header>
  <a href="../../index.html"><img src="../../images/Logo.png" alt="Toronto Primary School Logo"></a>
  <input type="checkbox" id="menu-bar">
  <label for="menu-bar"><i class="fas fa-bars"></i></label>
  <nav>
   <ul>
    <li><a href="../../index.html">Home</a></li>
    <li><a href="../../html/about/about.html">About</a></li>
    <li>
     <a href="#">Academics <i class="fas fa-caret-down"></i></a>
     <ul>
      <li><a href="../../html/academics/academics.html#curriculum">Curriculum</a></li>
      <li><a href="../../html/academics/academics.html#departments">Departments</a></li>
      <li><a href="../../html/academics/academics.html#subjects">Subjects</a></li>
      <li><a href="../../html/academics/academics.html#assessments">Assessments</a></li>
     </ul>
    </li>
    <li>
     <a href="#">Activities <i class="fas fa-caret-down"></i></a>
     <ul>
      <li><a href="../../html/activities/activities.html#extracurricular">Extracurricular Activities</a></li>
      <li><a href="../../html/activities/activities.html#sports">Sports</a></li>
      <li><a href="../../html/activities/activities.html#clubs">Clubs</a></li>
      <li><a href="../../html/activities/activities.html#events">Events</a></li>
     </ul>
    </li>
    <li>
     <a href="#">Admission <i class="fas fa-caret-down"></i></a>
     <ul>
      <li><a href="../../html/admission/admission.html#how-to-apply">How to Apply</a></li>
      <li><a href="../../html/admission/application-form.html">Application Form</a></li>
      <li><a href="../../html/admission/admission.html#requirements">Admission Requirements</a></li>
     </ul>
    </li>
    <li>
     <a href="#">Parents <i class="fas fa-caret-down"></i></a>
     <ul>
      <li><a href="../../html/parents/parents.html#sgb">SGB</a></li>
      <li><a href="../../html/parents/parents.html#resources">Resources for Parents</a></li>
     </ul>
    </li>
    <li><a href="../../html/announcements/announcement.html">Announcements</a></li>
    <li><a href="../../html/contact/contact.html">Contacts</a></li>
    <li>
     <div class="auth-buttons">
      <a href="../../html/auth/auth.html" class="btn-login active">Register/Login</a>
     </div>
    </li>
   </ul>
  </nav>
 </header>

 <main class="auth-container" aria-labelledby="auth-heading">
   <div class="form-container" role="region" aria-label="Authentication forms">
     <div id="register-form" class="form active-form" aria-hidden="false">
       <h2 id="auth-heading">Create an account</h2>
       <p class="form-note">Choose a role, complete the fields shown and register. Use an institutional email where available.</p>
       <form action="#" method="post">
    <select id="role-select" required>
     <option value="">-- Select Role --</option>
     <option value="learner">Learner</option>
     <option value="parent">Parent</option>
     <option value="teacher">Teacher</option>
     <option value="admissions-team">Admissions Team</option>
     <option value="smt">SMT (School Management)</option>
     <option value="admin">Admin (System)</option>
    </select>

    <div id="parent-fields" class="role-fields">
      <p class="form-note" style="margin-bottom: 15px; text-align: left;">To begin, please enter your learner's unique admission number.</p>
      <div class="form-group" style="display: flex; gap: 10px; align-items: center;">
        <input type="text" id="parent-admission-number-lookup" placeholder="Learner's Admission Number" required>
        <button type="button" id="find-learner-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-300 transition duration-150 whitespace-nowrap h-fit m-0">Find Learner</button>
      </div>

      <!-- This container will be shown after a learner is found -->
      <div id="parent-details-container" style="display: none; margin-top: 20px;">
        <p class="form-note success" style="margin-bottom: 15px; text-align: left;">
          <i class="fas fa-check-circle"></i> Learner found! Please confirm the details below and create your account.
        </p>
        <fieldset>
          <legend>Your Details (from school records)</legend>
          <div class="form-group"><input type="text" id="parent-name-display" placeholder="Parent Name" readonly></div>
          <div class="form-group"><input type="text" id="parent-surname-display" placeholder="Parent Surname" readonly></div>
          <div class="form-group"><input type="text" id="parent-contact-display" placeholder="Parent Contact" readonly></div>
        </fieldset>
        <fieldset>
          <legend>Learner Details</legend>
          <div class="form-group"><input type="text" id="learner-name-display" placeholder="Learner Name" readonly></div>
        </fieldset>
        <p class="form-note" style="margin-top: 15px; text-align: left;">Enter the email address you provided to the school to create your login.</p>
        <div class="form-group"><input type="email" name="parent-email" placeholder="Your Email Address" required></div>
      </div>
    </div>
    
    <div id="learner-fields" class="role-fields">
      <p class="form-note" style="margin-bottom: 15px; text-align: left;">To create your portal account, please enter your unique school admission number.</p>
      <div class="form-group" style="display: flex; gap: 10px; align-items: center;">
        <input type="text" id="learner-admission-number-lookup" placeholder="Your Admission Number" required>
        <button type="button" id="find-my-details-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-300 transition duration-150 whitespace-nowrap h-fit m-0">Find Me</button>
      </div>

      <!-- This container will be shown after a learner is found -->
      <div id="learner-details-container" style="display: none; margin-top: 20px;">
        <p class="form-note success" style="margin-bottom: 15px; text-align: left;">
          <i class="fas fa-check-circle"></i> We found you! Please confirm your details to create your account.
        </p>
        <fieldset>
          <legend>Your Details</legend>
          <div class="form-group"><label for="learner-reg-name">First Name</label><input type="text" id="learner-reg-name" required></div>
          <div class="form-group"><label for="learner-reg-surname">Surname</label><input type="text" id="learner-reg-surname" required></div>
          <div class="form-group"><label for="learner-reg-grade">Grade</label><input type="text" id="learner-reg-grade" readonly></div>
          <div class="form-group"><label for="learner-reg-id-number">ID Number (Your Temporary Password)</label><input type="text" id="learner-reg-id-number" readonly></div>
        </fieldset>
        <p class="form-note" style="margin-top: 15px; text-align: left;">
          Your username for login will be your <strong>Admission Number</strong>. Your temporary password is your <strong>ID Number</strong> shown above. You will be asked to change it after your first login.
        </p>
      </div>
    </div>

    <div id="teacher-fields" class="role-fields">
     <div class="form-group"><input type="text" name="teacher-surname" placeholder="Surname" required></div>
     <div class="form-group"><input type="text" name="teacher-preferred-name" placeholder="Preferred Name" required></div>
     <div class="form-group"><input type="email" name="teacher-email" placeholder="Email" required></div>
     <!-- **NEW**: Department Selection Checkboxes -->
     <div class="form-group" style="grid-column: 1 / -1;">
        <label style="text-align: left; color: #6b7280;">Department(s) - Select all that apply</label>
        <div class="checkbox-group">
            <label><input type="checkbox" name="teacher-department" value="Science & Maths"> Science & Maths</label>
            <label><input type="checkbox" name="teacher-department" value="Languages"> Languages</label>
            <label><input type="checkbox" name="teacher-department" value="Humanities (SS, LO)"> Humanities (SS, LO)</label>
            <label><input type="checkbox" name="teacher-department" value="Foundation Phase (All)"> Foundation Phase (All)</label>
        </div>
     </div>

     <fieldset class="role-specific-fieldset">
      <legend>Class Teacher Information</legend>
      <div class="form-group">
          <label for="is-class-teacher" style="display: block; margin-bottom: 5px; text-align: left; color: #6b7280;">Are you a class teacher?</label>
          <select id="is-class-teacher" name="is-class-teacher">
              <option value="" selected>-- Please Select --</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
          </select>
      </div>
      <!-- Section for Primary Responsible Class (if 'Yes') -->
      <div id="class-teacher-details-container" style="display: none;">
          <p class="form-note" style="margin-bottom: 10px; text-align: left;">Specify your primary responsible class:</p>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--gap);">
            <div class="form-group">
                <label for="responsible-phase" style="display: block; margin-bottom: 5px; text-align: left; color: #6b7280;">Phase</label>
                <select id="responsible-phase" name="responsible-phase">
                    <option value="">-- Select Phase --</option>
                    <option value="foundation">Foundation Phase</option>
                    <option value="intersen">Intersen Phase</option>
                </select>
            </div>
            <div class="form-group">
                <label for="responsible-grade" style="display: block; margin-bottom: 5px; text-align: left; color: #6b7280;">Grade</label>
                <select id="responsible-grade" name="responsible-grade" disabled>
                    <option value="">-- Select Phase First --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="responsible-section" style="display: block; margin-bottom: 5px; text-align: left; color: #6b7280;">Class Section</label>
                <input type="text" id="responsible-section" name="responsible-section" placeholder="e.g., A, B, Red" maxlength="10" style="text-transform: uppercase;">
            </div>
          </div>
      </div>
      <!-- Section for All Taught Grades & Subjects (shows for 'Yes' and 'No') -->
      <div id="teaching-assignments-container" style="display: none;">
        <p class="form-note" style="margin-bottom: 10px; text-align: left;">List each specific class and subject you teach.</p>
        <div id="assignments-list">
          <!-- Dynamic assignment rows will be inserted here -->
        </div>
        <button type="button" id="add-assignment-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-300 transition duration-150 mt-2 flex items-center gap-2">
          <i class="fas fa-plus"></i> Add Teaching Assignment
        </button>
      </div>
     </fieldset>
    </div>

    <div id="smt-fields" class="role-fields">
      <div class="form-group"><input type="text" name="smt-surname" placeholder="Surname" required></div>
      <div class="form-group"><input type="text" name="smt-preferred-name" placeholder="Preferred Name" required></div>
      <div class="form-group"><input type="email" name="smt-email" placeholder="Email" required></div>
      <div class="form-group">
        <select name="smt-specific-role" required>
          <option value="">-- Select SMT Role --</option>
          <option value="principal">Principal</option>
          <option value="deputy-principal-1">1st Deputy Principal</option>
          <option value="deputy-principal-2">2nd Deputy Principal</option>
          <option value="dh">DH (Departmental Head)</option>
        </select>
      </div>
      <!-- **NEW**: Fields specific to Departmental Heads (DH) -->
      <div id="dh-specific-fields" style="display: none; grid-column: 1 / -1;">
        <fieldset class="role-specific-fieldset">
            <legend>Departmental Head Details</legend>
            <div class="form-group">
                <label>Department(s) - Select all that apply</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="dh-department" value="Science & Maths"> Science & Maths</label>
                    <label><input type="checkbox" name="dh-department" value="Languages"> Languages</label>
                    <label><input type="checkbox" name="dh-department" value="Humanities"> Humanities (SS, LO)</label>
                    <label><input type="checkbox" name="dh-department" value="Foundation Phase"> Foundation Phase (All)</label>
                </div>
            </div>
            <div class="form-group">
                <label>Responsible for which Grade(s) - Select all that apply</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="dh-grade" value="R-3"> Foundation (R-3)</label>
                    <label><input type="checkbox" name="dh-grade" value="4-7"> Intersen (4-7)</label>
                </div>
            </div>
        </fieldset>
      </div>
    </div>
        
            <div id="admissions-team-fields" class="role-fields">
     <div class="form-group"><input type="text" name="admissions-surname" placeholder="Surname" required></div>
     <div class="form-group"><input type="text" name="admissions-preferred-name" placeholder="Preferred Name" required></div>
     <div class="form-group"><input type="email" name="admissions-email" placeholder="Email" required></div>
     <div class="form-group"><input type="text" name="admissions-special-id" placeholder="Staff ID" required></div>
    </div>

    <div id="admin-fields" class="role-fields">
     <div class="form-group"><input type="text" name="admin-surname" placeholder="Surname" required></div>
     <div class="form-group"><input type="text" name="admin-preferred-name" placeholder="Preferred Name" required></div>
     <div class="form-group"><input type="email" name="admin-email" placeholder="Email" required></div>
     <div class="form-group"><input type="text" name="admin-special-id" placeholder="Special ID" required></div>
    </div>

    <div id="password-section">
      <div class="password-wrapper">
        <input type="password" name="password" placeholder="Password" id="registerPassword" required>
        <i class="fas fa-eye toggle-password" aria-hidden="true"></i>
      </div>
      <div class="password-wrapper">
        <input type="password" name="confirm-password" placeholder="Confirm Password" id="confirmPassword" required>
        <i class="fas fa-eye toggle-password" aria-hidden="true"></i>
      </div>
    </div>

    <button id="registerSubmit" type="submit">Register</button>

    <div class="mt-4 flex items-center justify-between">
      <span class="border-b w-1/5 lg:w-1/4"></span>
      <span class="text-xs text-center text-gray-500 uppercase">or</span>
      <span class="border-b w-1/5 lg:w-1/4"></span>
    </div>
    <button type="button" id="google-register-btn" class="w-full mt-4 bg-white border border-gray-300 text-gray-700 font-bold py-2 px-4 rounded flex items-center justify-center hover:bg-gray-50 transition duration-150">
      <i class="fab fa-google mr-2 text-red-500"></i> Sign up with Google
    </button>
   </form>
     </div>

     <div id="login-form" class="form" aria-hidden="true">
       <h2>Sign in</h2>
       <p class="form-note">Select your role and enter your credentials.</p>
       <form action="#" method="post">
    <select id="login-role-select" required>
     <option value="">-- Select Role --</option>
     <option value="learner">Learner</option>
     <option value="parent">Parent</option>
     <option value="teacher">Teacher</option>
     <option value="admissions-team">Admissions Team</option>
     <option value="smt">SMT (School Management)</option>
     <option value="admin">Admin (System)</option>
    </select>
    <!-- Generic email input for most roles -->
    <input type="email" name="email" placeholder="Email Address" id="loginEmail" required>
    <!-- Specific admission number input for learners, hidden by default -->
    <input type="text" name="admission-number" placeholder="Admission Number" id="loginAdmissionNumber" style="display: none;">
    <div class="password-wrapper">
      <input type="password" name="password" placeholder="Password" id="loginPassword" required>
      <i class="fas fa-eye toggle-password" aria-hidden="true"></i>
    </div>
    <button id="loginSubmit" type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-150 mt-4">Log In</button>
    <div class="mt-4 flex items-center justify-between">
      <span class="border-b w-1/5 lg:w-1/4"></span>
      <span class="text-xs text-center text-gray-500 uppercase">or</span>
      <span class="border-b w-1/5 lg:w-1/4"></span>
    </div>
    <button type="button" id="google-login-btn" class="w-full mt-4 bg-white border border-gray-300 text-gray-700 font-bold py-2 px-4 rounded flex items-center justify-center hover:bg-gray-50 transition duration-150">
      <i class="fab fa-google mr-2 text-red-500"></i> Sign in with Google
    </button>
    <p id="learner-login-note" class="form-note" style="display: none; margin-top: 15px;">
      Learners: Use your Admission Number as the username and your ID Number as the password.
    </p>
    <div class="forgot-password-link-container">
     <a href="#" id="show-forgot-password">Forgot Password?</a>
    </div>
   </form>
     </div>

     <div id="forgot-password-form" class="form" aria-hidden="true" style="display: none;">
      <h2>Reset Password</h2>
      <p class="form-note">Enter your email address and we'll send you a link to reset your password.</p>
      <form action="#" method="post">
       <input type="email" name="forgot-email" placeholder="Your Email Address" id="forgotEmail" required>
       <button id="forgotSubmit" type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-150 mt-4">Send Reset Link</button>
      </form>
     </div>

     <div class="form-links">
       <a id="show-register">Register</a>
       <span>|</span>
       <a id="show-login">Log In</a>
     </div>
   </div>
 </main>

 <!-- ========================================================= -->
 <!-- === NEW: FORCE PASSWORD CHANGE MODAL FOR FIRST LOGIN === -->
 <!-- ========================================================= -->
 <div id="force-password-change-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h2>Update Your Password</h2>
    <p class="form-note">For your security, you must change your temporary password before proceeding.</p>
    <form id="force-password-change-form">
      <div class="password-wrapper">
        <label for="current-password-modal">Current Password (Your ID Number)</label>
        <input type="password" id="current-password-modal" required>
        <i class="fas fa-eye toggle-password" aria-hidden="true"></i>
      </div>
      <div class="password-wrapper">
        <label for="new-password-modal">New Password</label>
        <input type="password" id="new-password-modal" required>
        <i class="fas fa-eye toggle-password" aria-hidden="true"></i>
      </div>
      <div class="password-wrapper">
        <label for="confirm-new-password-modal">Confirm New Password</label>
        <input type="password" id="confirm-new-password-modal" required>
        <i class="fas fa-eye toggle-password" aria-hidden="true"></i>
      </div>
      <button type="submit" id="update-password-submit-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-150 mt-4">Update Password & Continue</button>
    </form>
  </div>
 </div>

 <footer class="site-footer" role="contentinfo" aria-label="Site footer">
  <div class="container footer-grid">
    <div class="footer-brand">
      <a href="../../index.html" class="brand"><img src="../../images/Logo.png" alt="Toronto Primary School Logo"></a>
      <p class="footer-tagline">Delivering quality primary education in Mankweng, Limpopo.</p>
    </div>

    <nav class="footer-nav" aria-label="Footer quick links">
      <h4>Quick links</h4>
      <ul>
        <li><a href="../../index.html">Home</a></li>
        <li><a href="../../html/about/about.html">About</a></li>
        <li><a href="../../html/admission/admission.html#how-to-apply">Admission</a></li>
        <li><a href="../../html/academics/academics.html">Academics</a></li>
        <li><a href="../../html/contact/contact.html">Contact</a></li>
      </ul>
    </nav>

      <div class="footer-contact" aria-label="Contact details">
        <h4>Contact</h4>
        <address>
          Toronto Primary School<br>
          389 Unit-B<br>
          Mankweng, 0727, Limpopo<br>
          South Africa
        </address>
        <p class="contact-lines">
          <a href="tel:+27763307544">+27 76 330 7544</a><br>
          <a href="mailto:torontoprimaryschool24@gmail.com">torontoprimaryschool24@gmail.com</a>
        </p>
      </div>

      <div class="footer-newsletter">
        <h4>Stay informed</h4>
        <p class="muted">Subscribe for news, events and term dates.</p>
        <form class="newsletter-form" action="#" method="post" aria-label="Subscribe to newsletter">
          <label for="newsletter-email" class="sr-only">Email address</label>
          <input id="newsletter-email" type="email" name="email" placeholder="Your email" required>
          <button type="submit" class="btn-subscribe">Subscribe</button>
        </form>

        <div class="footer-social" aria-hidden="false">
          <a href="#" aria-label="Twitter" class="social-icon"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="#" aria-label="Facebook" class="social-icon"><i class="fa-brands fa-facebook-f"></i></a>
          <a href="#" aria-label="Instagram" class="social-icon"><i class="fa-brands fa-instagram"></i></a>
          <a href="#" aria-label="LinkedIn" class="social-icon"><i class="fa-brands fa-linkedin-in"></i></a>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <small>&copy; 2025 Toronto Primary School. All rights reserved. School Emis No: 923241498</small>
    </div>
  </footer>

</body>
</html>